@using GarangeInventory.Storage;
@inject Data.DataService Data

<SelectLocation @bind-pickedStorageUnit="storageUnit"
                @bind-pickedShelfUnit="@shelfUnit"
                @bind-pickedShelf="shelf"
                @bind-pickedBox="box"></SelectLocation>

@code {
    public Item item { get; set; }

    [Parameter]
    public string message { get; set; }
    [Parameter]
    public EventCallback<string> messageChanged { get; set; }

    async Task UpdateMessageChanged()
    {
        await messageChanged.InvokeAsync(message);
    }

    StorageUnit storageUnit;
    ShelfUnit shelfUnit;
    Shelf shelf;
    Box box;



    public void AddItemToLocation()
    {
        if (item.Name == null)
        {
            message = "Item Name is missing!";
            return;
        }
        if (storageUnit == null)
        {
            message = "Storage has not been selected";
            return;
        }

        if (item.Name != null && storageUnit != null)
        {
            //add item to Box
            if (box != null)
            {
                box.Items.Add(item);
                message = $"{item.Name} saved sucessfully to {box.Name} !";
                return;
            }

            //Add Item to shelf
            if (shelf != null)
            {
                shelf.Items.Add(item);
                message = $"{item.Name} saved sucessfully to {shelf.Name} !";
                return;
            }

            //Add Item to ShelfUnit

            if (shelfUnit != null)
            {
                shelfUnit.Items.Add(item);
                message = $"{item.Name} saved sucessfully to {shelfUnit.Name} !";
                return;
            }
                
            if (message == null)
            {
                message = $"Failed to save !!!";
            }
            Data.SaveToFile();
            ResetForm();
        }
    }

    private void ResetForm()
    {
        storageUnit = null;
        shelfUnit = null;
        shelf = null;
        box = null;
    }

}
